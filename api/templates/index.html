<!DOCTYPE html>
<html lang="en">
{% include 'header.html' %}
    <body>

        <section id="init_section" class="bg-gray-50 min-h-screen flex flex-col items-center justify-center px-4 sm:px-6 lg:px-8">
            <div class="flex gap-4 items-center">
                <div id="init_logo" class="flex justify-center items-center animate-fade-up">
                    <svg class="w-8" viewBox="0 0 487 469" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M242.962 49.1417V234.5L190.285 210.36C96.755 167.254 38.7019 87.0754 38.7019 0H0V212.085C0 281.055 49.4525 344.853 127.932 375.028L244.038 419.859V234.5L296.715 258.64C390.245 301.746 448.298 381.925 448.298 469H487V256.915C487 187.945 437.548 124.147 359.068 93.9724L242.962 49.1417Z" fill="#201B21"/>
                    </svg>
                </div>
                <div>
                    <div class="text-2xl font-bold text-gray-900 animate-fade-right animate-delay-[800ms]">
                        Sulphr    
                    </div>
                </div>
            </div>
            <p class="mt-4 lg:hidden text-gray-600 animate-fade-up animate-delay-[1500ms]">
                Swipe right to sign in, and left to sign up.
            </p>
            <p class="mt-4 hidden lg:block text-gray-600 animate-fade-up animate-delay-[1500ms]">
                Press right to sign in, and left to sign up.
            </p>
        </section>

        <section id="signin_section" class="hidden bg-gray-50 min-h-screen flex items-center justify-center px-4 sm:px-6 lg:px-8">
            <div class="h-screen flex flex-col pb-6">
                <div class="h-full flex flex-col justify-center">
                    <div class="-mt-20 max-w-4xl w-full text-center mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex justify-center items-center animate-fade-up">
                            <svg class="w-8" viewBox="0 0 487 469" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M242.962 49.1417V234.5L190.285 210.36C96.755 167.254 38.7019 87.0754 38.7019 0H0V212.085C0 281.055 49.4525 344.853 127.932 375.028L244.038 419.859V234.5L296.715 258.64C390.245 301.746 448.298 381.925 448.298 469H487V256.915C487 187.945 437.548 124.147 359.068 93.9724L242.962 49.1417Z" fill="#201B21"/>
                            </svg>
                        </div>
        
                        <h1 class="mt-3 text-3xl font-bold text-gray-800 sm:text-4xl animate-fade-up animate-delay-[300ms]">
                            Welcome Back to Sulphr
                        </h1>
                        <p id="signin_question_email" class="mt-1 text-gray-600 animate-fade-up animate-delay-[600ms]">
                            Please enter your email address.
                        </p>
                        <p id="signin_question_pwd" class="hidden mt-1 text-gray-600">
                            Please enter your password.
                        </p>
                    </div>
        
                    <div class="mt-10 max-w-2xl w-full mx-auto px-4 sm:px-6 lg:px-8 animate-fade-up animate-delay-[800ms]">
                        <div class="relative">
                            <div id="email-error" class="text-red-500 text-sm hidden text-center mb-2"></div>
                            <input id="signin_answer_email" type="text" class="p-4 block w-full border-gray-200 rounded-full text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none" placeholder="user@mail.com">
                            
                            <div id="password-error" class="text-red-500 text-sm hidden text-center mb-2"></div>
                            <input id="signin_answer_pwd" type="password" class="hidden p-4 block w-full border-gray-200 rounded-full text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none" placeholder="••••••••">
        
                            <div onclick="signin()" class="absolute top-1/2 end-2 -translate-y-1/2">
                                <button type="button" class="inline-flex shrink-0 justify-center items-center size-8 rounded-full text-white bg-blue-600 hover:bg-blue-500 focus:z-10 focus:outline-none focus:bg-blue-500">
                                    <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="signup_section" class="hidden bg-gray-50 min-h-screen flex items-center justify-center px-4 sm:px-6 lg:px-8">
            <div class="h-screen flex flex-col pb-6">
                <div class="h-full flex flex-col justify-center">
                    <div class="-mt-20 max-w-4xl w-full text-center mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex justify-center items-center animate-fade-up">
                            <svg class="w-8" viewBox="0 0 487 469" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M242.962 49.1417V234.5L190.285 210.36C96.755 167.254 38.7019 87.0754 38.7019 0H0V212.085C0 281.055 49.4525 344.853 127.932 375.028L244.038 419.859V234.5L296.715 258.64C390.245 301.746 448.298 381.925 448.298 469H487V256.915C487 187.945 437.548 124.147 359.068 93.9724L242.962 49.1417Z" fill="#201B21"/>
                            </svg>
                        </div>

                        <h1 class="mt-3 text-3xl font-bold text-gray-800 sm:text-4xl animate-fade-up animate-delay-[300ms]">
                            Welcome to Sulphr
                        </h1>
                        <p id="signup_question_fullname" class="mt-1 text-gray-600 animate-fade-up animate-delay-[600ms]">
                            Let's get started with your name.
                        </p>
                        <p id="signup_question_email" class="hidden mt-1 text-gray-600">
                            What's your email address?
                        </p>
                        <p id="signup_question_pwd" class="hidden mt-1 text-gray-600">
                            What password would you like to use?
                        </p>
                    </div>

                    <div class="mt-10 max-w-2xl w-full mx-auto px-4 sm:px-6 lg:px-8 animate-fade-up animate-delay-[800ms]">
                        <div class="relative">
                            
                            <div id="fullname-error" class="text-red-500 text-sm hidden text-center mb-2">The full name entered does not meet the required format.</div>
                            <input id="signup_answer_fullname" type="text" class="p-4 block w-full border-gray-200 rounded-full text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none" placeholder="John Smith">
                            
                            <div id="email-error" class="text-red-500 text-sm hidden text-center mb-2">The email address entered is not valid.</div>
                            <input id="signup_answer_email" type="text" class="hidden p-4 block w-full border-gray-200 rounded-full text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none" placeholder="user@mail.com">
                            
                            <div id="password-error" class="text-red-500 text-sm hidden text-center mb-2">The password you entered does not meet the required criteria. Please ensure that the password is at least 8 characters long.</div>
                            <input id="signup_answer_pwd" type="password" class="hidden p-4 block w-full border-gray-200 rounded-full text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none" placeholder="••••••••">

                            <div onclick="signup()" class="absolute top-1/2 end-2 -translate-y-1/2">
                                <button type="button" class="inline-flex shrink-0 justify-center items-center size-8 rounded-full text-white bg-blue-600 hover:bg-blue-500 focus:z-10 focus:outline-none focus:bg-blue-500">
                                    <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </body>
</html>

<script>

    var step = 0;
    const signup_question_fullname = document.getElementById('signup_question_fullname');
    const signup_question_email = document.getElementById('signup_question_email');
    const signup_question_pwd = document.getElementById('signup_question_pwd');
    const signup_answer_fullname = document.getElementById('signup_answer_fullname');
    const signup_answer_email = document.getElementById('signup_answer_email');
    const signup_answer_pwd = document.getElementById('signup_answer_pwd');
    const fullnameError = document.getElementById('fullname-error');
    const emailError = document.getElementById('email-error');
    const passwordError = document.getElementById('password-error');

    function verifyEmail() {
        const email = signin_answer_email.value.trim();
        const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
        if (!email) {
            emailError.textContent = "Email is required.";
            emailError.classList.remove('hidden');
            return false;
        } else if (!emailPattern.test(email)) {
            emailError.textContent = "Please enter a valid email address.";
            emailError.classList.remove('hidden');
            return false;
        } else {
            emailError.classList.add('hidden');
        }
        return true;
    }

    function verifyPassword() {
        const password = signin_answer_pwd.value.trim();
        if (!password) {
            passwordError.textContent = "Password is required.";
            passwordError.classList.remove('hidden');
            return false;
        } else if (password.length < 8) {
            passwordError.textContent = "Password must be at least 8 characters.";
            passwordError.classList.remove('hidden');
            return false;
        } else {
            passwordError.classList.add('hidden');
        }
        return true;
    }

    function signin() {
        if (step === 0) {
            if (verifyEmail()) {
                signin_question_email.classList.add('hidden');
                signin_question_pwd.classList.remove('hidden');
                signin_question_pwd.classList.add('animate-fade-up');
                signin_answer_email.classList.add('hidden');
                signin_answer_pwd.classList.remove('hidden');
                step = 1;
            }
        } else if (step === 1) {
            if (verifyPassword()) {
                const hashedPassword = hashPassword(signin_answer_pwd.value.trim());
                fetch('/api/signin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: signin_answer_email.value.trim(),
                        password: hashedPassword,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert("Sign in successful!");
                    } else {
                        alert("Invalid credentials.");
                    }
                })
                .catch(error => {
                    console.error("Error during sign-in:", error);
                    alert("An error occurred during sign-in.");
                }); 
            }
        }
    }
    
    function validateFullname() {
        const fullname = signup_answer_fullname.value.trim();
        if (!fullname) {
            fullnameError.textContent = "Full name is required.";
            fullnameError.classList.remove('hidden');
            return false;
        } else {
            fullnameError.classList.add('hidden');
        }
        return true;
    }

    function validateEmail() {
        const email = signup_answer_email.value.trim();
        const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
        if (!email) {
            emailError.textContent = "Email is required.";
            emailError.classList.remove('hidden');
            return false;
        } else if (!emailRegex.test(email)) {
            emailError.textContent = "Please enter a valid email address.";
            emailError.classList.remove('hidden');
            return false;
        } else {
            emailError.classList.add('hidden');
        }
        return true;
    }

    function validatePassword() {
        const password = signup_answer_pwd.value.trim();
        if (!password) {
            passwordError.textContent = "Password is required.";
            passwordError.classList.remove('hidden');
            return false;
        } else if (password.length < 8) {
            passwordError.textContent = "Password must be at least 8 characters.";
            passwordError.classList.remove('hidden');
            return false;
        } else {
            passwordError.classList.add('hidden');
        }
        return true;
    }

    function signup() {
        if (step === 0) {
            if (validateFullname()) {
                signup_question_fullname.classList.add('hidden');
                signup_question_email.classList.remove('hidden');
                signup_question_email.classList.add('animate-fade-up');
                signup_answer_fullname.classList.add('hidden');
                signup_answer_email.classList.remove('hidden');
                step = 1;
            }
        } else if (step === 1) {
            if (validateEmail()) {
                signup_question_email.classList.add('hidden');
                signup_question_pwd.classList.remove('hidden');
                signup_question_pwd.classList.add('animate-fade-up');
                signup_answer_email.classList.add('hidden');
                signup_answer_pwd.classList.remove('hidden');
                step = 2;
            }
        } else if (step === 2) {
            if (validatePassword()) {
                const hashedPassword = hashPassword(signup_answer_pwd.value.trim());
                fetch('/api/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        full_name: signup_answer_fullname.value.trim(),
                        email: signup_answer_email.value.trim(),
                        password: hashedPassword,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status) {
                        setCookie('full_name', signup_answer_fullname.value.trim());
                        setCookie('email', signup_answer_email.value.trim());
                        window.location.href = '/init';
                    } else {
                        alert("Sign up failed.");
                    }
                })
            } else {
                passwordError.textContent = "Password is not 8 digits.";
            }
        }
    }

    const signin_section = document.getElementById('signin_section')
    const signup_section = document.getElementById('signup_section');
    const init_section = document.getElementById('init_section')

    let touchStartX = 0;
    let hasSwiped = false;

    document.addEventListener('touchstart', (e) => {
        if (hasSwiped) return;
        touchStartX = e.touches[0].clientX;
    });

    document.addEventListener('touchend', (e) => {
        if (hasSwiped) return;
            const touchEndX = e.changedTouches[0].clientX;
            if (touchEndX > touchStartX) {
                console.log('swiped right');
                init_section.classList.add('hidden');
                signin_section.classList.remove('hidden');
                signin_section.classList.add('animate-fade-right')
            } else if (touchEndX < touchStartX) {
                console.log('swiped left');
                init_section.classList.add('hidden')
                signup_section.classList.remove('hidden');
                signup_section.classList.add('animate-fade-left');
            }
            hasSwiped = true;
    });

    let clicked = false;
    document.addEventListener('keydown', function(event) {
        if (!clicked) {
            if (event.key === 'ArrowRight' || event.code === 'ArrowRight' || event.keyCode === 39) {
                console.log('Right Arrow key was pressed');
                init_section.classList.add('hidden');
                signin_section.classList.remove('hidden');
                signin_section.classList.add('animate-fade-right')
                clicked = true;
            } else if (event.key === 'ArrowLeft') {
                console.log('Left Arrow key was pressed');
                init_section.classList.add('hidden')
                signup_section.classList.remove('hidden');
                signup_section.classList.add('animate-fade-left');
                clicked = true;
            }
        }
    });

    function hashPassword(password) {
        return CryptoJS.SHA256(password).toString(CryptoJS.enc.Hex);
    }

</script>